<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PatientDetails Claim Search</title>
    <!-- Bootstrap CSS for better styling -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        @keyframes fadeInSlide {
                    0% {
                        opacity: 0;
                        transform: translateY(-20px);
                    }
                    100% {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }

                .animated-heading {
                    animation: fadeInSlide 1s ease-in-out;
                }
    </style>
</head>
<body>
<div style="text-align: right;" class="container mt-5">
    <a align="right" class="btn btn-primary mb-3" th:href="@{/logout}">Logout</a>
</div>
    <div class="container mt-5">
        <div class="container mt-5">
            <h1 class="animated-heading text-center text-black p-3 rounded shadow-lg"
                style="background: linear-gradient(to right, #6a11cb, #2575fc);">PatientDetails Form</h1>
            <!--<p sec:authentication="principal.authorities">Current Roles: <span th:text="${#authentication.authorities}"></span></p>-->
            <div sec:authorize="hasAuthority('ROLE_ADMIN')">
                <a class="btn btn-primary mb-3" th:href="@{/registerPatient}">New Patient</a>
            </div>
            <form th:action="@{/searchPatient}" th:object="${patientDetails}" method="POST">
                <!-- CSRF token for security -->
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <div class="form-group">
                    <label for="id">Patient ID:</label>
                    <input type="number" id="id" th:field="*{id}" class="form-control" />
                </div>
                <div class="form-row">
                    <div class="form-group col-md-4">
                        <label for="patientName">Patient Name:</label>
                        <input type="text" id="patientName" th:field="*{patientName}" class="form-control" readonly/>
                    </div>
                    <div class="form-group col-md-4">
                        <label for="patientDOB">Date of Birth:</label>
                        <input type="date" id="patientDOB" th:field="*{patientDOB}" class="form-control" readonly/>
                    </div>
                    <div class="form-group col-md-4">
                        <label for="gender">Gender:</label>
                        <input id="gender" th:field="*{gender}" class="form-control" readonly/>
                    </div>
                </div>
                <div th:if="${patientExist != null and !patientExist}">
                    <p class="text-danger">Patient Not Exist!!</p>
                </div>
                <div th:if="${patientExist != null and patientExist and patientDetails.patientName != null}">
                    <div sec:authorize="hasAuthority('ROLE_ADMIN')">
                    <a class="btn btn-primary mb-3" th:href="@{/getPatient(patientId = ${patientDetails.id})}">Edit Patient</a>
                    </div>
                </div>
                <br>
                <button type="submit" class="btn btn-primary">Search Patient with Claims</button>
                <div class="mt-5" th:if="${listClaims}">
                    <div sec:authorize="hasAuthority('ROLE_ADMIN')">
                    <a class="btn btn-primary mb-3" th:href="@{/newClaim(patientId = ${patientDetails.id})}">New Claim</a>
                    </div>
                    <h3>Claims:</h3>
                    <table class="table table-bordered">
                        <thead>
                        <tr>
                            <th>Claim ID</th>
                            <th>Created</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="claim : ${listClaims}">
                            <td>
                                <a th:href="@{/claimEdit(claimId = ${claim.id})}" th:text="${claim.id}"></a>
                            </td>
                            <td>
                                <span th:text="${claim.created}"></span>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </form>
        </div>
        <!-- Bootstrap JS and dependencies -->
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    </div>
</body>
</html>